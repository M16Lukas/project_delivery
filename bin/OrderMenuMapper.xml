<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 고객회원 주문 기능관련 xml : 고객회원 매장 검색, 카테고리, 주문 기능 -->
<mapper namespace="dao.OrderMenuMapper">

<!-- 매장 출력 기능-->
<select id="printStoreByCategory" resultType="store" parameterType="hashmap">
select
	store_num
	,store_name
    ,store_phone
    ,minorderprice
    ,deliverytime
    ,deliverytip
from
	store
<where>

<!-- 5,000원 이하 -->
<if test="minOrderPrice == 1"> deliverytip between 0 and 5000 and </if>
<!-- 10,000원 이하 -->
<if test="minOrderPrice == 2"> deliverytip between 0 and 10000 and </if>
<!-- 12,000원 이하 -->
<if test="minOrderPrice == 3"> deliverytip between 0 and 12000 and </if>
<!-- 15,000원 이하 -->
<if test="minOrderPrice == 4"> deliverytip between 0 and 15000 and </if>
<!-- 20,000원 이하 -->
<if test="minOrderPrice == 5"> deliverytip between 0 and 20000 and </if>

<!-- 특정 업종 매장만 출력 -->
<if test="code_num != 0"> code_num = #{code_num} and</if>
	
area_num = #{area_num}
</where>

order by

<choose>
	<!-- 1 : 기본순 -->
	<when test="sortType == 1"> store_num desc </when>
	<!-- 2 : 배달빠른 순 -->
	<when test="sortType == 2"> deliverytime asc</when>
	<!-- 3 : 배달팁 낮은 순 -->
	<when test="sortType == 3"> deliverytip asc </when>
	<otherwise>store_num desc</otherwise>
</choose>
</select>


<!-- 검색된 매장 출력 기능 -->
<select id="searchStore" resultType="store" parameterType="hashmap">
select
	store_num
	,store_name
    ,store_phone
    ,minorderprice
    ,deliverytime
    ,deliverytip
from
	store
where
	upper(store_name) like '%' || upper(#{name}) || '%'
and
	area_num = #{area_num}
</select>


<!-- 메뉴 추가 기능 -->
<insert id="addMenu" parameterType="menu">
insert into
	menu(menu_num, store_num, menu_name, menu_intro, menu_price)
values 
	(menu_seq.nextval, #{store_num}, #{menu_name}, #{menu_intro, jdbcType=VARCHAR}, #{menu_price})
</insert>

</mapper>